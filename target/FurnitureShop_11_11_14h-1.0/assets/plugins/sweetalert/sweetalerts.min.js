$(document).ready(function () {
    // Basic Alert
    $("#basic-alert").on("click", function () {
        Swal.fire({
            title: "Any fool can use a computer",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Alert with Title
    $("#with-title").on("click", function () {
        Swal.fire({
            title: "The Internet?,",
            text: "That thing is still around?",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Footer Alert
    $("#footer-alert").on("click", function () {
        Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Something went wrong!",
            footer: "<a href>Why do I have this issue?</a>",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // HTML Alert
    $("#html-alert").on("click", function () {
        Swal.fire({
            title: "<strong>HTML <u>example</u></strong>",
            icon: "info",
            html: 'You can use <b>bold text</b>, <a href="https://pixinvent.com/" target="_blank">links</a> and other HTML tags',
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText: '<i class="fa fa-thumbs-up"></i> Great!',
            confirmButtonAriaLabel: "Thumbs up, great!",
            cancelButtonText: '<i class="fa fa-thumbs-down"></i>',
            cancelButtonAriaLabel: "Thumbs down",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false,
            cancelButtonClass: "btn btn-danger ml-1"
        });
    });

    // Position Alerts
    $("#position-top-start").on("click", function (e) {
        e.preventDefault();  // Ngăn ngừa việc gửi form theo cách thông thường

        var formData = $("form").serialize();  // Lấy tất cả dữ liệu từ form

        $.ajax({
            url: "category-controller?action=addCategory",  // URL gửi đến server
            type: "POST",                // Phương thức POST
            data: formData,              // Dữ liệu gửi đi từ form
            success: function (response) {
                if (response.status === "success") {
                    Swal.fire({
                        icon: "success",
                        title: "Danh mục đã được thêm thành công",
                        showConfirmButton: false,
                        timer: 3000
                    }).then(() => {
                        window.location.href = "category-controller?action=getCategoryList"; // Điều hướng đến danh sách
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Lỗi",
                        text: response.message,
                        confirmButtonClass: "btn btn-danger",
                        buttonsStyling: false
                    });
                }
            },
            error: function () {
                Swal.fire({
                    icon: "error",
                    title: "Đã xảy ra lỗi!",
                    text: "Vui lòng thử lại",
                    confirmButtonClass: "btn btn-danger",
                    buttonsStyling: false
                });
            }
        });
    });

    $("#position-top-end").on("click", function () {
        Swal.fire({
            position: "top-end",
            icon: "success",
            title: "Your work has been saved",
            showConfirmButton: false,
            timer: 1500,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#position-bottom-start").on("click", function () {
        Swal.fire({
            position: "bottom-start",
            icon: "success",
            title: "Your work has been saved",
            showConfirmButton: false,
            timer: 1500,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#position-bottom-end").on("click", function () {
        Swal.fire({
            position: "bottom-end",
            icon: "success",
            title: "Your work has been saved",
            showConfirmButton: false,
            timer: 1500,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Animation Alerts
    $("#bounce-in-animation").on("click", function () {
        Swal.fire({
            title: "Bounce In Animation",
            animation: false,
            customClass: "animated bounceIn",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#fade-in-animation").on("click", function () {
        Swal.fire({
            title: "Fade In Animation",
            animation: false,
            customClass: "animated fadeIn",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#flip-x-animation").on("click", function () {
        Swal.fire({
            title: "Flip In Animation",
            animation: false,
            customClass: "animated flipInX",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#tada-animation").on("click", function () {
        Swal.fire({
            title: "Tada Animation",
            animation: false,
            customClass: "animated tada",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#shake-animation").on("click", function () {
        Swal.fire({
            title: "Shake Animation",
            animation: false,
            customClass: "animated shake",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Alerts with Different Types
    $("#type-success").on("click", function () {
        Swal.fire({
            title: "Good job!",
            text: "You clicked the button!",
            icon: "success",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#type-info").on("click", function () {
        Swal.fire({
            title: "Info!",
            text: "You clicked the button!",
            icon: "info",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#type-warning").on("click", function () {
        Swal.fire({
            title: "Warning!",
            text: "You clicked the button!",
            icon: "warning",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    $("#type-error").on("click", function () {
        Swal.fire({
            title: "Error!",
            text: "You clicked the button!",
            icon: "error",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Custom Icon
    $("#custom-icon").on("click", function () {
        Swal.fire({
            title: "Sweet!",
            text: "Modal with a custom image.",
            imageUrl: "../../../app-assets/images/slider/04.jpg",
            imageWidth: 400,
            imageHeight: 200,
            imageAlt: "Custom image",
            animation: false,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Auto Close Alert
    $("#auto-close").on("click", function () {
        let timerInterval;
        Swal.fire({
            title: "Auto close alert!",
            html: "I will close in <strong></strong> seconds.",
            timer: 2000,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false,
            didOpen: () => {
                Swal.showLoading();
                timerInterval = setInterval(() => {
                    Swal.getHtmlContainer().querySelector("strong").textContent = Swal.getTimerLeft();
                }, 100);
            },
            willClose: () => {
                clearInterval(timerInterval);
            }
        }).then((result) => {
            if (result.dismiss === Swal.DismissReason.timer) {
                console.log("I was closed by the timer");
            }
        });
    });

    // Click Outside to Close
    $("#outside-click").on("click", function () {
        Swal.fire({
            title: "Click outside to close!",
            text: "This is a cool message!",
            allowOutsideClick: true,
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false
        });
    });

    // Prompt Function
    $("#prompt-function").on("click", function () {
        Swal.mixin({
            input: "text",
            confirmButtonText: "Next &rarr;",
            showCancelButton: true,
            progressSteps: ["1", "2", "3"],
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false,
            cancelButtonClass: "btn btn-danger ml-1"
        }).queue([
            { title: "Question 1", text: "Chaining swal2 modals is easy" },
            "Question 2",
            "Question 3"
        ]).then((result) => {
            if (result.value) {
                Swal.fire({
                    title: "All done!",
                    html: "Your answers: <pre><code>" + JSON.stringify(result.value) + "</code></pre>",
                    confirmButtonText: "Lovely!"
                });
            }
        });
    });

    // AJAX Request
    $("#ajax-request").on("click", function () {
        Swal.fire({
            title: "Search for a user",
            input: "text",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: false,
            inputAttributes: {
                autocapitalize: "off"
            },
            showCancelButton: true,
            confirmButtonText: "Look up",
            showLoaderOnConfirm: true,
            cancelButtonClass: "btn btn-danger ml-1",
            preConfirm: (username) => {
                return fetch(`https://api.github.com/users/${username}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(response.statusText);
                        }
                        return response.json();
                    })
                    .catch(error => {
                        Swal.showValidationMessage(`Request failed: ${error}`);
                    });
            },
            allowOutsideClick: () => !Swal.isLoading()
        }).then((result) => {
            if (result.value) {
                Swal.fire({
                    title: `${result.value.login}'s avatar`,
                    imageUrl: result.value.avatar_url
                });
            }
        });
    });
    $("#categoryForm").on("submit", function (e) {
        e.preventDefault();  // Ngừng gửi form theo cách thông thường

        var formData = $(this).serialize();  // Lấy dữ liệu từ form

        $.ajax({
            url: "category-controller",  // URL gửi form đến controller
            type: "POST",                // Phương thức gửi POST
            data: formData,              // Dữ liệu form gửi đi
            success: function (response) {
                if (response.status === "success") {
                    Swal.fire({
                        icon: "success",
                        title: "Thao tác hoàn tất.",
                        showConfirmButton: false,
                        timer: 3000
                    }).then(() => {
                        window.location.href = "category-controller?action=getCategoryList";  // Chuyển hướng đến danh sách danh mục
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Lỗi",
                        text: "Thao tác thất bại.",
                        confirmButtonClass: "btn btn-danger",
                        buttonsStyling: false
                    });
                }
            },
            error: function () {
                Swal.fire({
                    icon: "error",
                    title: "Đã xảy ra lỗi!",
                    text: "Vui lòng thử lại",
                    confirmButtonClass: "btn btn-danger",
                    buttonsStyling: false
                });
            }
        });
    });
    $("#furnitureForm").on("submit", function (e) {
        e.preventDefault();  // Ngừng gửi form theo cách thông thường

        var formData = new FormData(this);  // Lấy dữ liệu từ form, bao gồm file

        // Cập nhật lại danh sách các ảnh bị xóa vào trường removedImageIds
        var removedImageIds = $("#removedImageIds").val();
        if (removedImageIds) {
            formData.append("removedImageIds", removedImageIds);  // Thêm danh sách ảnh bị xóa vào formData
        }

        $.ajax({
            url: "product-controller",  // URL gửi form đến controller
            type: "POST",               // Phương thức gửi POST
            data: formData,             // Dữ liệu form gửi đi (bao gồm file và các trường khác)
            processData: false,         // Không xử lý dữ liệu khi gửi (vì là FormData)
            contentType: false,         // Không cần chỉ định content-type (FormData sẽ tự xử lý)
            success: function (response) {
                if (response.status === "success") {
                    Swal.fire({
                        icon: "success",
                        title: "Thao tác hoàn tất.",
                        showConfirmButton: false,
                        timer: 3000
                    }).then(() => {window.location.href = "product-controller?action=getFurnitureList";  // Chuyển hướng đến danh sách danh mục
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Lỗi",
                        text: response.message,
                        confirmButtonClass: "btn btn-danger",
                        buttonsStyling: false
                    });
                }
            },
            error: function () {
                Swal.fire({
                    icon: "error",
                    title: "Đã xảy ra lỗi!",
                    text: "Vui lòng thử lại",
                    confirmButtonClass: "btn btn-danger",
                    buttonsStyling: false
                });
            }
        });
    });
    // Confirm Text
    $(".confirm-text").on("click", function (e) {
        e.preventDefault();
        const id = $(this).data("id"); // Lấy ID từ thuộc tính data-id
        const action = $(this).attr("id") === "delete-btn" ? "deleteFurniture" : "restoreFurniture"; // Xác định hành động

        Swal.fire({
            title: "Bạn có chắc chắn không?",
            text: "Bạn không thể hoàn tác lại nếu đồng ý!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            cancelButtonText: "Hủy",
            confirmButtonText: "Đồng ý",
            customClass: {
                confirmButton: "btn btn-primary",
                cancelButton: "btn btn-danger ml-1"
            },
            buttonsStyling: false
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: "product-controller",
                    method: "POST",
                    data: {
                        action: action,
                        id: id
                    },
                    success: (response) => {
                        Swal.fire({
                            icon: "success",
                            title: "Thành công!",
                            text: "Thao tác hoàn tất.",
                            confirmButtonClass: "btn btn-success"
                        }).then(() => {
                            location.reload(); // Reload lại trang nếu cần
                        });
                    },
                    error: (xhr, status, error) => {
                        Swal.fire({
                            icon: "error",
                            title: "Lỗi!",
                            text: "Đã xảy ra lỗi khi thực hiện thao tác.",
                            confirmButtonClass: "btn btn-danger"
                        });
                    }
                });
            }
        });
    });
});
